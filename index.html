<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global News Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #ffffff;
            --bg-secondary: #f3f4f6;
            --text-primary: #111827;
            --text-secondary: #4b5563;
            --border-color: #e5e7eb;
            --accent-color: #3b82f6;
            --news-blue: #3b82f6;
            --news-red: #ef4444;
            --news-purple: #8b5cf6;
            --news-white: #f9fafb;
            --slider-bg: #e5e7eb;
        }

        .dark-mode {
            --bg-primary: #1f2937;
            --bg-secondary: #111827;
            --text-primary: #f9fafb;
            --text-secondary: #d1d5db;
            --border-color: #374151;
            --accent-color: #60a5fa;
            --news-blue: #60a5fa;
            --news-red: #f87171;
            --news-purple: #a78bfa;
            --news-white: #f3f4f6;
            --slider-bg: #374151;
        }

        body {
            background-color: var(--bg-primary);
            color: var(--text-primary);
            transition: background-color 0.3s, color 0.3s;
        }

        .tab {
            background-color: var(--bg-secondary);
            color: var(--text-secondary);
            border: 1px solid var(--border-color);
        }

        .active-tab {
            background-color: var(--bg-primary);
            color: var(--text-primary);
            border-bottom: none;
        }

        .news-container {
            background-color: var(--bg-primary);
            border: 1px solid var(--border-color);
        }

        .news-panel {
            border-color: var(--border-color);
        }

        .chat-message {
            border-radius: 0.75rem;
            padding: 0.75rem;
            margin-bottom: 0.75rem;
            max-width: 80%;
            position: relative;
        }

        .news-blue {
            background-color: var(--news-blue);
            color: white;
        }

        .news-red {
            background-color: var(--news-red);
            color: white;
        }

        .news-purple {
            background-color: var(--news-purple);
            color: white;
        }

        .news-white {
            background-color: var(--news-white);
            color: black;
        }

        .filter-button {
            cursor: pointer;
            transition: opacity 0.3s;
        }

        .filter-button.inactive {
            opacity: 0.3;
        }

        .cartoon-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 2rem;
        }

        .cartoon-image {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background-color: #ddd;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 0.5rem;
            overflow: hidden;
            position: relative;
        }

        .cartoon-initials {
            font-size: 2.5rem;
            font-weight: bold;
        }

        .speech-bubble {
            position: relative;
            background-color: var(--bg-secondary);
            border-radius: 0.75rem;
            padding: 0.75rem;
            max-width: 90%;
            margin-top: 0.5rem;
        }

        .speech-bubble:after {
            content: '';
            position: absolute;
            top: -10px;
            left: 50%;
            border-width: 0 10px 10px;
            border-style: solid;
            border-color: var(--bg-secondary) transparent;
            transform: translateX(-50%);
        }

        .slider-container {
            width: 100%;
            height: 30px;
            background-color: var(--slider-bg);
            border-radius: 15px;
            position: relative;
            margin: 1.5rem 0;
            overflow: hidden;
        }

        .slider-indicator {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            background: linear-gradient(to right, #3b82f6 0%, #8b5cf6 100%);
            border-radius: 15px;
            transition: width 0.3s;
        }

        .slider-label {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            font-size: 0.75rem;
            font-weight: bold;
            color: white;
            text-shadow: 0 0 2px rgba(0, 0, 0, 0.5);
            padding: 0 10px;
        }

        .slider-label.left {
            left: 10px;
        }

        .slider-label.right {
            right: 10px;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Loading animation */
        .loading {
            display: inline-block;
            width: 80px;
            height: 80px;
        }
        .loading:after {
            content: " ";
            display: block;
            width: 64px;
            height: 64px;
            margin: 8px;
            border-radius: 50%;
            border: 6px solid var(--accent-color);
            border-color: var(--accent-color) transparent var(--accent-color) transparent;
            animation: loading 1.2s linear infinite;
        }
        @keyframes loading {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="min-h-screen">
    <div class="container mx-auto px-4 py-6">
        <!-- Header -->
        <header class="flex justify-between items-center mb-6">
            <h1 class="text-3xl font-bold">Global News Dashboard</h1>
            <div class="flex items-center space-x-4">
                <div class="flex items-center">
                    <span id="countdown-label" class="mr-2">Next update in:</span>
                    <span id="countdown-timer" class="font-mono">01:00</span>
                </div>
                <button id="dark-mode-toggle" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">
                    <i class="fas fa-moon"></i>
                </button>
            </div>
        </header>

        <!-- Tabs -->
        <div class="flex border-b border-gray-200 mb-4">
            <div id="israel-tab" class="px-6 py-3 tab active-tab cursor-pointer">Israel</div>
            <div id="usa-tab" class="px-6 py-3 tab cursor-pointer">USA</div>
            <div id="international-tab" class="px-6 py-3 tab cursor-pointer">International</div>
        </div>

        <!-- Tab Content -->
        <div id="tab-content-container">
            <!-- Israel Tab -->
            <div id="israel-content" class="tab-content active">
                <!-- Filter Buttons -->
                <div class="flex mb-4 space-x-2">
                    <div class="text-sm font-semibold mr-2 flex items-center">Filter:</div>
                    <span class="filter-button px-3 py-1 rounded-full text-white bg-blue-500" data-color="blue">Regular</span>
                    <span class="filter-button px-3 py-1 rounded-full text-white bg-red-500" data-color="red">Extraordinary</span>
                    <span class="filter-button px-3 py-1 rounded-full text-white bg-purple-500" data-color="purple">Deep State</span>
                    <span class="filter-button px-3 py-1 rounded-full bg-gray-100 text-gray-800" data-color="white">High Ranking</span>
                </div>

                <!-- People vs Deep State Slider -->
                <div class="slider-container">
                    <div class="slider-indicator" style="width: 30%;"></div>
                    <div class="slider-label left">People</div>
                    <div class="slider-label right">Deep State</div>
                </div>

                <div class="news-container p-4 rounded-lg">
                    <div class="flex flex-col md:flex-row md:space-x-4">
                        <!-- Left Panel: Chat Style News -->
                        <div class="news-panel w-full md:w-1/2 border-r p-4 mb-4 md:mb-0">
                            <h2 class="text-xl font-bold mb-4">Political Updates</h2>
                            <div class="chat-container h-[600px] overflow-y-auto" id="israel-chat">
                                <div class="loading-container flex justify-center items-center h-full">
                                    <div class="loading"></div>
                                </div>
                            </div>
                        </div>

                        <!-- Right Panel: Cartoons -->
                        <div class="news-panel w-full md:w-1/2 p-4">
                            <h2 class="text-xl font-bold mb-4">Key Figures</h2>
                            <div class="cartoon-gallery h-[600px] overflow-y-auto" id="israel-cartoons">
                                <div class="loading-container flex justify-center items-center h-full">
                                    <div class="loading"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- USA Tab -->
            <div id="usa-content" class="tab-content">
                <!-- Filter Buttons -->
                <div class="flex mb-4 space-x-2">
                    <div class="text-sm font-semibold mr-2 flex items-center">Filter:</div>
                    <span class="filter-button px-3 py-1 rounded-full text-white bg-blue-500" data-color="blue">Regular</span>
                    <span class="filter-button px-3 py-1 rounded-full text-white bg-red-500" data-color="red">Extraordinary</span>
                    <span class="filter-button px-3 py-1 rounded-full text-white bg-purple-500" data-color="purple">Deep State</span>
                    <span class="filter-button px-3 py-1 rounded-full bg-gray-100 text-gray-800" data-color="white">High Ranking</span>
                </div>

                <!-- People vs Deep State Slider -->
                <div class="slider-container">
                    <div class="slider-indicator" style="width: 40%;"></div>
                    <div class="slider-label left">People</div>
                    <div class="slider-label right">Deep State</div>
                </div>

                <div class="news-container p-4 rounded-lg">
                    <div class="flex flex-col md:flex-row md:space-x-4">
                        <!-- Left Panel: Chat Style News -->
                        <div class="news-panel w-full md:w-1/2 border-r p-4 mb-4 md:mb-0">
                            <h2 class="text-xl font-bold mb-4">Political Updates</h2>
                            <div class="chat-container h-[600px] overflow-y-auto" id="usa-chat">
                                <div class="loading-container flex justify-center items-center h-full">
                                    <div class="loading"></div>
                                </div>
                            </div>
                        </div>

                        <!-- Right Panel: Cartoons -->
                        <div class="news-panel w-full md:w-1/2 p-4">
                            <h2 class="text-xl font-bold mb-4">Key Figures</h2>
                            <div class="cartoon-gallery h-[600px] overflow-y-auto" id="usa-cartoons">
                                <div class="loading-container flex justify-center items-center h-full">
                                    <div class="loading"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- International Tab -->
            <div id="international-content" class="tab-content">
                <!-- Filter Buttons -->
                <div class="flex mb-4 space-x-2">
                    <div class="text-sm font-semibold mr-2 flex items-center">Filter:</div>
                    <span class="filter-button px-3 py-1 rounded-full text-white bg-blue-500" data-color="blue">Regular</span>
                    <span class="filter-button px-3 py-1 rounded-full text-white bg-red-500" data-color="red">Extraordinary</span>
                    <span class="filter-button px-3 py-1 rounded-full text-white bg-purple-500" data-color="purple">Deep State</span>
                    <span class="filter-button px-3 py-1 rounded-full bg-gray-100 text-gray-800" data-color="white">High Ranking</span>
                </div>

                <!-- People vs Deep State Slider -->
                <div class="slider-container">
                    <div class="slider-indicator" style="width: 35%;"></div>
                    <div class="slider-label left">People</div>
                    <div class="slider-label right">Deep State</div>
                </div>

                <div class="news-container p-4 rounded-lg">
                    <div class="flex flex-col md:flex-row md:space-x-4">
                        <!-- Left Panel: Chat Style News -->
                        <div class="news-panel w-full md:w-1/2 border-r p-4 mb-4 md:mb-0">
                            <h2 class="text-xl font-bold mb-4">Political Updates</h2>
                            <div class="chat-container h-[600px] overflow-y-auto" id="international-chat">
                                <div class="loading-container flex justify-center items-center h-full">
                                    <div class="loading"></div>
                                </div>
                            </div>
                        </div>

                        <!-- Right Panel: Cartoons -->
                        <div class="news-panel w-full md:w-1/2 p-4">
                            <h2 class="text-xl font-bold mb-4">Key Figures</h2>
                            <div class="cartoon-gallery h-[600px] overflow-y-auto" id="international-cartoons">
                                <div class="loading-container flex justify-center items-center h-full">
                                    <div class="loading"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // API Key for NewsAPI
        const API_KEY = '330b7eb40246456dbf18361191ae93be';

        // DOM Elements
        const darkModeToggle = document.getElementById('dark-mode-toggle');
        const countdownTimer = document.getElementById('countdown-timer');
        const tabs = document.querySelectorAll('[id$="-tab"]');
        const tabContents = document.querySelectorAll('[id$="-content"]');
        const filterButtons = document.querySelectorAll('.filter-button');

        // Tab configuration
        const tabConfig = {
            'israel': { country: 'il', category: 'general' },
            'usa': { country: 'us', category: 'general' },
            'international': { country: 'gb', category: 'general' } // Using UK as proxy for international
        };

        // Initialize countdown
        let countdown = 60; // 1 minute in seconds for first update
        const hourInSeconds = 3600; // 1 hour in seconds for subsequent updates

        // Initialize dark mode from local storage
        if (localStorage.getItem('darkMode') === 'enabled') {
            document.body.classList.add('dark-mode');
            darkModeToggle.innerHTML = '<i class="fas fa-sun"></i>';
        }

        // Deep state related keywords for categorization
        const deepStateKeywords = [
            'deep state', 'conspiracy', 'shadow government', 'surveillance', 'intelligence agency',
            'nsa', 'cia', 'fbi', 'secret service', 'classified', 'leak', 'whistleblower',
            'cover-up', 'scandal', 'corruption', 'oligarch', 'elite', 'establishment'
        ];

        // High ranking official keywords
        const highRankingKeywords = [
            'president', 'prime minister', 'chancellor', 'vice president', 'secretary of state',
            'minister', 'ambassador', 'head of state', 'speaker', 'majority leader', 'senator',
            'governor', 'premier', 'chief'
        ];

        // Extraordinary news keywords
        const extraordinaryKeywords = [
            'breaking', 'urgent', 'exclusive', 'shocking', 'unprecedented',
            'crisis', 'emergency', 'conflict', 'war', 'attack', 'protest',
            'riot', 'coup', 'assassination', 'scandal', 'controversy', 'resignation'
        ];

        // Function to categorize news
        function categorizeNews(article) {
            const title = article.title.toLowerCase();
            const description = article.description ? article.description.toLowerCase() : '';
            const content = article.content ? article.content.toLowerCase() : '';
            const combinedText = title + ' ' + description + ' ' + content;

            // Check for high ranking officials first
            for (const keyword of highRankingKeywords) {
                if (combinedText.includes(keyword)) {
                    return 'news-white';
                }
            }

            // Check for deep state related news
            for (const keyword of deepStateKeywords) {
                if (combinedText.includes(keyword)) {
                    return 'news-purple';
                }
            }

            // Check for extraordinary news
            for (const keyword of extraordinaryKeywords) {
                if (combinedText.includes(keyword)) {
                    return 'news-red';
                }
            }

            // Default to regular news
            return 'news-blue';
        }

        // Function to fetch news from NewsAPI
        async function fetchNews(country, category) {
            try {
                const url = `https://newsapi.org/v2/top-headlines?country=${country}&category=${category}&apiKey=${API_KEY}`;
                const response = await fetch(url);
                const data = await response.json();

                if (data.status === 'ok') {
                    return data.articles;
                } else {
                    console.error('Error fetching news:', data.message);
                    return [];
                }
            } catch (error) {
                console.error('Error fetching news:', error);
                return [];
            }
        }

        // Function to create a chat message element
        function createChatMessage(article, newsClass) {
            const chatMessage = document.createElement('div');
            chatMessage.className = `chat-message ${newsClass}`;
            chatMessage.setAttribute('data-category', newsClass);

            const title = document.createElement('h3');
            title.className = 'font-bold';
            title.textContent = article.title;

            const content = document.createElement('p');
            content.textContent = article.description || 'No description available';

            const source = document.createElement('div');
            source.className = 'text-xs mt-2 opacity-75';
            source.textContent = `Source: ${article.source.name || 'Unknown'} â€¢ ${new Date(article.publishedAt).toLocaleString()}`;

            chatMessage.appendChild(title);
            chatMessage.appendChild(content);
            chatMessage.appendChild(source);

            return chatMessage;
        }

        // Function to create a cartoon representation of a person
        function createCartoonRepresentation(article, newsClass) {
            const name = extractPersonName(article.title) || 'Unknown';
            const action = extractAction(article.title, article.description);

            const container = document.createElement('div');
            container.className = 'cartoon-container';
            container.setAttribute('data-category', newsClass);

            const cartoonImage = document.createElement('div');
            cartoonImage.className = `cartoon-image ${newsClass}`;
            
            const initials = document.createElement('div');
            initials.className = 'cartoon-initials';
            initials.textContent = getInitials(name);
            
            const nameElement = document.createElement('div');
            nameElement.className = 'font-bold text-center mt-2';
            nameElement.textContent = name;
            
            const speechBubble = document.createElement('div');
            speechBubble.className = 'speech-bubble';
            speechBubble.textContent = action;

            cartoonImage.appendChild(initials);
            container.appendChild(cartoonImage);
            container.appendChild(nameElement);
            container.appendChild(speechBubble);

            return container;
        }

        // Helper function to extract person name from article title
        function extractPersonName(title) {
            if (!title) return null;
            
            // Array of known political figures for better extraction
            const politicians = [
                'Biden', 'Trump', 'Harris', 'Obama', 'Netanyahu', 'Putin', 'Zelensky', 
                'Johnson', 'Sunak', 'Macron', 'Scholz', 'Trudeau', 'Xi', 'Modi'
            ];
            
            // Check if any politician name appears in the title
            for (const politician of politicians) {
                if (title.includes(politician)) {
                    return politician;
                }
            }
            
            // If no known politician found, try to extract a name using patterns
            const nameRegex = /([A-Z][a-z]+ [A-Z][a-z]+)/;
            const nameMatch = title.match(nameRegex);
            
            return nameMatch ? nameMatch[1] : 'Political Figure';
        }

        // Helper function to extract action from article
        function extractAction(title, description) {
            if (!title) return 'No information available';
            
            // If description exists, use a concise version of it
            if (description) {
                return description.length > 100 ? description.substring(0, 100) + '...' : description;
            }
            
            // Otherwise, try to extract action from title
            const parts = title.split(':');
            if (parts.length > 1) {
                return parts[1].trim();
            }
            
            return title;
        }

        // Helper function to get initials from a name
        function getInitials(name) {
            if (!name) return 'UN';
            
            const nameParts = name.split(' ');
            if (nameParts.length === 1) {
                return nameParts[0].substring(0, 2).toUpperCase();
            }
            
            return (nameParts[0][0] + nameParts[nameParts.length - 1][0]).toUpperCase();
        }

        // Function to update news content for a specific tab
        async function updateTabContent(tabName) {
            const chatContainer = document.getElementById(`${tabName}-chat`);
            const cartoonContainer = document.getElementById(`${tabName}-cartoons`);
            
            // Show loading state
            chatContainer.innerHTML = '<div class="loading-container flex justify-center items-center h-full"><div class="loading"></div></div>';
            cartoonContainer.innerHTML = '<div class="loading-container flex justify-center items-center h-full"><div class="loading"></div></div>';
            
            const { country, category } = tabConfig[tabName];
            const articles = await fetchNews(country, category);
            
            if (articles.length === 0) {
                chatContainer.innerHTML = '<div class="p-4 text-center">No news available. Please try again later.</div>';
                cartoonContainer.innerHTML = '<div class="p-4 text-center">No news figures available.</div>';
                return;
            }
            
            // Clear loading state
            chatContainer.innerHTML = '';
            cartoonContainer.innerHTML = '';
            
            // Process and display articles
            articles.forEach(article => {
                // Skip articles without a title
                if (!article.title) return;
                
                const newsClass = categorizeNews(article);
                
                // Create and append chat message
                const chatMessage = createChatMessage(article, newsClass);
                chatContainer.appendChild(chatMessage);
                
                // Only create cartoons for personalities (not every news article)
                if (extractPersonName(article.title)) {
                    const cartoon = createCartoonRepresentation(article, newsClass);
                    cartoonContainer.appendChild(cartoon);
                }
            });
            
            // If no cartoons were created (no personalities found), show a message
            if (cartoonContainer.children.length === 0) {
                cartoonContainer.innerHTML = '<div class="p-4 text-center">No political figures in current news.</div>';
            }
        }

        // Function to update all tabs
        async function updateAllTabs() {
            for (const tabName of Object.keys(tabConfig)) {
                await updateTabContent(tabName);
            }
            
            // Reset countdown for next update
            countdown = hourInSeconds; // Set to 1 hour for subsequent updates
        }

        // Function to update countdown timer
        function updateCountdown() {
            const minutes = Math.floor(countdown / 60);
            const seconds = countdown % 60;
            
            countdownTimer.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            countdown--;
            
            if (countdown < 0) {
                // Time to update content
                updateAllTabs();
            }
        }

        // Initialize tabs
        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                // Remove active class from all tabs and tab contents
                tabs.forEach(t => t.classList.remove('active-tab'));
                tabContents.forEach(c => c.classList.remove('active'));
                
                // Add active class to clicked tab and corresponding content
                tab.classList.add('active-tab');
                const contentId = tab.id.replace('-tab', '-content');
                document.getElementById(contentId).classList.add('active');
            });
        });

        // Initialize filter buttons
        filterButtons.forEach(button => {
            button.addEventListener('click', () => {
                button.classList.toggle('inactive');
                const color = button.getAttribute('data-color');
                const isActive = !button.classList.contains('inactive');
                
                // Get current active tab
                const activeTabId = document.querySelector('.active-tab').id;
                const activeTabName = activeTabId.replace('-tab', '');
                
                // Filter chat messages
                const chatMessages = document.querySelectorAll(`#${activeTabName}-chat .chat-message`);
                chatMessages.forEach(message => {
                    if (message.getAttribute('data-category') === `news-${color}`) {
                        message.style.display = isActive ? 'block' : 'none';
                    }
                });
                
                // Filter cartoon representations
                const cartoons = document.querySelectorAll(`#${activeTabName}-cartoons .cartoon-container`);
                cartoons.forEach(cartoon => {
                    if (cartoon.getAttribute('data-category') === `news-${color}`) {
                        cartoon.style.display = isActive ? 'block' : 'none';
                    }
                });
            });
        });

        // Initialize dark mode toggle
        darkModeToggle.addEventListener('click', () => {
            document.body.classList.toggle('dark-mode');
            
            if (document.body.classList.contains('dark-mode')) {
                localStorage.setItem('darkMode', 'enabled');
                darkModeToggle.innerHTML = '<i class="fas fa-sun"></i>';
            } else {
                localStorage.setItem('darkMode', 'disabled');
                darkModeToggle.innerHTML = '<i class="fas fa-moon"></i>';
            }
        });

        // Initialize sliders (they are currently static, but could be made interactive)
        const sliders = document.querySelectorAll('.slider-container');
        sliders.forEach(slider => {
            slider.addEventListener('click', (e) => {
                const rect = slider.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const percentage = (x / rect.width) * 100;
                
                // Update slider position
                const indicator = slider.querySelector('.slider-indicator');
                indicator.style.width = `${percentage}%`;
            });
        });

        // Start countdown and update content on load
        setInterval(updateCountdown, 1000);
        updateAllTabs(); // Initial update
    </script>
</body>
</html>
